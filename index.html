<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æˆ‘çš„ PWA</title>

    <!-- Android / å¸¸è§„æµè§ˆå™¨ç”¨ -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#317EFB" />

    <!-- iOS ä¸“ç”¨ -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="æˆ‘çš„PWA" />
    <link rel="apple-touch-icon" href="icon.png" />

    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        padding: 2em;
      }
      #installBtn {
        display: none;
        padding: 10px 20px;
        font-size: 16px;
        background: #317efb;
        color: white;
        border: none;
        border-radius: 5px;
      }
      .launch-status {
        margin: 20px;
        padding: 10px;
        border-radius: 5px;
        background-color: #f0f0f0;
      }
    </style>
  </head>
  <body>
    <h1>æ¬¢è¿ä½¿ç”¨æˆ‘çš„ PWA åº”ç”¨</h1>
    <p>ä½ å¯ä»¥æŠŠå®ƒæ·»åŠ åˆ°ä¸»å±å¹•ï¼Œåƒ App ä¸€æ ·ä½¿ç”¨ï¼</p>
    <div id="launchStatus" class="launch-status"></div>
    <button id="installBtn">å®‰è£…åˆ°ä¸»å±å¹•</button>

    <script>
      // æ³¨å†Œ service worker
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("service-worker.js")
          .then(() => console.log("âœ… Service Worker æ³¨å†ŒæˆåŠŸ"))
          .catch((err) => console.error("âŒ æ³¨å†Œå¤±è´¥:", err));
      }

      // åˆ¤æ–­æ˜¯å¦æ˜¯ä»ä¸»å±å¹•å¯åŠ¨ï¼ˆiOSï¼‰
      const launchStatus = document.getElementById("launchStatus");
      if (
        navigator.standalone ||
        window.matchMedia("(display-mode: standalone)").matches
      ) {
        launchStatus.textContent = "âœ… å½“å‰æ˜¯ä»ä¸»å±å¹•å¯åŠ¨çš„";
        launchStatus.style.backgroundColor = "#e6ffe6";
        console.log("âœ… å½“å‰æ˜¯ä»ä¸»å±å¹•å¯åŠ¨çš„");
      } else {
        launchStatus.textContent = "ğŸ“± å½“å‰æ˜¯åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€çš„";
        launchStatus.style.backgroundColor = "#fff3e6";
        console.log("ğŸ“± å½“å‰æ˜¯åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€çš„");
      }

      // å®‰è£…æç¤º
      let deferredPrompt;
      const installBtn = document.getElementById("installBtn");

      //åœ¨ Chromeï¼ˆå’Œå¤§å¤šæ•° Android æµè§ˆå™¨ï¼‰ ä¸­ï¼Œä¸€æ—¦ç”¨æˆ·å·²ç»å®‰è£…è¿‡è¿™ä¸ª PWAï¼šbeforeinstallprompt äº‹ä»¶å°±ä¸ä¼šå†æ¬¡è§¦å‘ï¼Œ
      //åœ¨ iOSï¼ˆSafariï¼‰ ä¸Šï¼Œæ²¡æœ‰ beforeinstallprompt äº‹ä»¶
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = "inline-block";
      });

      installBtn.addEventListener("click", () => {
        installBtn.style.display = "none";
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === "accepted") {
              console.log("âœ… ç”¨æˆ·æ¥å—äº†å®‰è£…");
            } else {
              console.log("âŒ ç”¨æˆ·æ‹’ç»äº†å®‰è£…");
            }
            deferredPrompt = null;
          });
        }
      });
    </script>
  </body>
</html>
